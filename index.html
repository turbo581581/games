<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Shoe Dog åˆ›ä¸šæ¨¡æ‹Ÿ 2.0 - å®è§‚ç»æµç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #020617;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 64px;
      display: flex;
      gap: 24px;
    }
    .card {
      background: radial-gradient(circle at top left, #0b1120 0, #020617 50%, #000 100%);
      border-radius: 18px;
      padding: 20px 24px;
      box-shadow: 0 20px 45px rgba(0,0,0,0.75);
      border: 1px solid #1f2937;
    }
    .left {
      flex: 2;
    }
    .right {
      flex: 1.3;
    }
    h1 {
      margin: 0 0 12px;
      font-size: 24px;
      color: #f97316;
      letter-spacing: 0.5px;
    }
    h2 {
      margin: 0 0 8px;
      font-size: 18px;
    }
    .question-id {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .question-text {
      font-size: 18px;
      margin-bottom: 16px;
      line-height: 1.7;
    }
    .option-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }
    .option-btn {
      text-align: left;
      border-radius: 999px;
      border: 1px solid #374151;
      padding: 10px 14px;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.12s ease, transform 0.08s ease, box-shadow 0.1s ease, border-color 0.1s ease;
    }
    .option-btn span.key {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #4b5563;
      font-weight: 600;
      font-size: 12px;
      color: #f97316;
    }
    .option-btn:hover {
      background: #0f172a;
      border-color: #6b7280;
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(15,23,42,0.9);
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    .pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .stat {
      padding: 8px 10px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 13px;
    }
    .stat-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      color: #9ca3af;
    }
    .stat-value {
      font-size: 16px;
      font-weight: 600;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #4b5563;
      color: #9ca3af;
      gap: 6px;
      margin-right: 6px;
    }
    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #f97316;
    }
    .log {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px dashed #1f2937;
      font-size: 12px;
      color: #9ca3af;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-line-event {
      color: #facc15;
    }
    .log-line-choice {
      color: #9ca3af;
    }
    .footer {
      text-align: center;
      font-size: 12px;
      color: #6b7280;
      margin-top: 12px;
    }
    .section-title {
      font-size: 14px;
      color: #9ca3af;
      margin-top: 10px;
      margin-bottom: 4px;
    }
    .macro-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 4px;
    }
    .macro {
      padding: 6px 8px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid #111827;
      font-size: 12px;
    }
    .macro-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
      color: #9ca3af;
    }
    .macro-value {
      font-size: 14px;
      font-weight: 600;
    }
    .macro-warning {
      color: #f97316;
      font-size: 11px;
      margin-top: 2px;
    }
    .result-title {
      font-size: 20px;
      margin-bottom: 6px;
      color: #facc15;
    }
    .result-text {
      font-size: 14px;
      line-height: 1.6;
      color: #e5e7eb;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦ä¾§ï¼šé—®é¢˜ + é€‰æ‹© -->
    <div class="card left">
      <h1>Shoe Dog åˆ›ä¸šæ¨¡æ‹Ÿ 2.0 Â· å®è§‚ç»æµç‰ˆ</h1>
      <div class="pill">
        <span class="dot"></span>
        <span id="round-info">ç¬¬ 1 å…³ / å…± 11 å…³</span>
      </div>
      <div>
        <span class="badge">
          <span class="badge-dot"></span> å®ä½“ç»è¥
        </span>
        <span class="badge">
          <span class="badge-dot" style="background:#22c55e;"></span> å®è§‚ç»æµ
        </span>
        <span class="badge">
          <span class="badge-dot" style="background:#3b82f6;"></span> éšæœºé»‘å¤©é¹…
        </span>
      </div>

      <div class="question-id" id="question-id"></div>
      <div class="question-text" id="question-text"></div>
      <div class="option-list" id="option-list"></div>

      <div class="log" id="log"></div>

      <div class="footer">
        æ¯ä¸€å…³çš„é€‰æ‹© + éšæœºå®è§‚äº‹ä»¶ä¼šå…±åŒå†³å®šï¼š<br/>
        ä½ æ˜¯è¢«å‘¨æœŸç¢¾ç¢ï¼Œè¿˜æ˜¯åœ¨æˆ˜äº‰ã€æ±‡ç‡ã€ä¸­ç¾å†²çªä¸­ï¼Œè¶…è¶Šå¥ˆç‰¹ã€‚
      </div>
    </div>

    <!-- å³ä¾§ï¼šå…¬å¸çŠ¶æ€ + å®è§‚ç¯å¢ƒ -->
    <div class="card right">
      <h2>å…¬å¸ç»è¥çŠ¶æ€</h2>
      <div class="stats-grid">
        <div class="stat"><div class="stat-label"><span>ğŸ’° ç°é‡‘æµ</span></div><div class="stat-value" id="stat-cash">0</div></div>
        <div class="stat"><div class="stat-label"><span>ğŸ“¦ ä¾›åº”é“¾å¥åº·</span></div><div class="stat-value" id="stat-supply">0</div></div>
        <div class="stat"><div class="stat-label"><span>ğŸ§² å“ç‰ŒåŠ›</span></div><div class="stat-value" id="stat-brand">0</div></div>
        <div class="stat"><div class="stat-label"><span>ğŸ§‘â€ğŸ¤â€ğŸ§‘ å›¢é˜Ÿå£«æ°”</span></div><div class="stat-value" id="stat-team">0</div></div>
        <div class="stat"><div class="stat-label"><span>ğŸ“ˆ æˆé•¿é€Ÿåº¦</span></div><div class="stat-value" id="stat-growth">0</div></div>
        <div class="stat"><div class="stat-label"><span>ğŸŒª å†…éƒ¨é£é™©</span></div><div class="stat-value" id="stat-risk">0</div></div>
      </div>

      <div class="section-title">ğŸŒ å®è§‚ç¯å¢ƒï¼ˆæ¯å›åˆå¯èƒ½éšæœºå˜åŒ–ï¼‰</div>
      <div class="macro-grid">
        <div class="macro">
          <div class="macro-label"><span>ğŸ’µ USD / CNY</span></div>
          <div class="macro-value" id="macro-usd">7.10</div>
          <div class="macro-warning" id="macro-usd-warn"></div>
        </div>
        <div class="macro">
          <div class="macro-label"><span>ğŸ§¾ å…³ç¨æ°´å¹³</span></div>
          <div class="macro-value" id="macro-tariff">10%</div>
          <div class="macro-warning" id="macro-tariff-warn"></div>
        </div>
        <div class="macro">
          <div class="macro-label"><span>ğŸ”¥ å…¨çƒé€šèƒ€</span></div>
          <div class="macro-value" id="macro-inflation">2%</div>
          <div class="macro-warning" id="macro-inflation-warn"></div>
        </div>
        <div class="macro">
          <div class="macro-label"><span>ğŸ¦ å…¨çƒåˆ©ç‡</span></div>
          <div class="macro-value" id="macro-interest">3.5%</div>
          <div class="macro-warning" id="macro-interest-warn"></div>
        </div>
        <div class="macro">
          <div class="macro-label"><span>ğŸš¢ ä¾›åº”é“¾å¤–éƒ¨é£é™©</span></div>
          <div class="macro-value" id="macro-supplyrisk">10</div>
          <div class="macro-warning" id="macro-supplyrisk-warn"></div>
        </div>
        <div class="macro">
          <div class="macro-label"><span>ğŸ§  æ¶ˆè´¹è€…ä¿¡å¿ƒ</span></div>
          <div class="macro-value" id="macro-confidence">80</div>
          <div class="macro-warning" id="macro-confidence-warn"></div>
        </div>
        <div class="macro">
          <div class="macro-label"><span>âš”ï¸ åœ°ç¼˜ç´§å¼ åº¦</span></div>
          <div class="macro-value" id="macro-geo">10</div>
          <div class="macro-warning" id="macro-geo-warn"></div>
        </div>
      </div>

      <div id="result-block" style="margin-top:16px; display:none;">
        <div class="result-title" id="result-title"></div>
        <div class="result-text" id="result-text"></div>
      </div>
    </div>
  </div>

  <script>
    // æ¸¸æˆçŠ¶æ€
    const state = {
      cash: 0,
      supply: 0,
      brand: 0,
      team: 0,
      growth: 0,
      risk: 0,
      history: []
    };

    // å®è§‚ç¯å¢ƒ
    const macro = {
      usdRate: 7.10,            // USD/CNY
      tariff: 10,              // %
      inflation: 2,            // %
      interestRate: 3.5,       // %
      externalSupplyRisk: 10,  // 0-100
      consumerConfidence: 80,  // 0-100
      geoTension: 10           // 0-100
    };

    // é—®é¢˜ï¼ˆåŸæœ‰ 11 å…³ï¼‰
    const questions = [
      {
        id: 1,
        text: "æ¯•ä¸šåï¼Œä½ æƒ³å¹²ä»€ä¹ˆï¼Ÿ",
        options: {
          A: { text: "å»ä¼šè®¡å¸ˆäº‹åŠ¡æ‰€ä¸Šç­ï¼ˆç¨³å®šå·¥ä½œï¼Œå­¦ä¹ è´¢åŠ¡ï¼‰", effects: { cash: 10, growth: 5, risk: -5 } },
          B: { text: "å»ç¯çƒæ—…è¡Œå¯»æ‰¾çµæ„Ÿï¼ˆå¼€çœ¼ç•Œï¼Œä½†èŠ±é’±ï¼‰", effects: { cash: -10, growth: 10, risk: 5, brand: 5 } },
          C: { text: "åœ¨å®¶å†™å•†ä¸šè®¡åˆ’ä¹¦ï¼ˆç†è®ºå……è¶³ï¼Œå®è·µä¸è¶³ï¼‰", effects: { cash: -5, growth: 5 } },
          D: { text: "éšä¾¿æ··å‡ å¹´ï¼ˆå®‰å…¨ä½†æµªè´¹æ—¶é—´ï¼‰", effects: { growth: -5, risk: -5 } }
        }
      },
      {
        id: 2,
        text: "ä½ èŒç”Ÿäº†åšè·‘é‹ç”Ÿæ„çš„æƒ³æ³•ï¼Œè¦ä¸è¦å»æ—¥æœ¬è°ˆä»£ç†ï¼Ÿ",
        options: {
          A: { text: "ç«‹åˆ»é£æ—¥æœ¬ï¼Œç¡¬åˆšæ‹œè®¿ä¾›åº”å•†", effects: { cash: -10, growth: 10, risk: 5, brand: 5 } },
          B: { text: "å†™é‚®ä»¶ç­‰å¯¹æ–¹å›å¤ï¼ˆå®‰å…¨ä½†èŠ‚å¥æ…¢ï¼‰", effects: { risk: -5, growth: -5 } },
          C: { text: "ä¸å»ï¼Œæ—¥æœ¬å¤ªè¿œå¤ªè´µï¼ˆæ”¾å¼ƒæœºä¼šï¼‰", effects: { growth: -10 } },
          D: { text: "å€Ÿé’±é£æ—¥æœ¬ï¼ˆé«˜é£é™©é«˜å›æŠ¥ï¼‰", effects: { cash: -20, growth: 15, risk: 10, brand: 5 } }
        }
      },
      {
        id: 3,
        text: "ä¾›åº”å•†é—®ï¼šä½ ä»¬å…¬å¸æœ‰å¤šå¤§ï¼Ÿå…¶å®å°±ä½ ä¸€ä¸ªäººï¼Œä½ æ€ä¹ˆå›ç­”ï¼Ÿ",
        options: {
          A: { text: "è€å®è¯´åªæœ‰æˆ‘ä¸€ä¸ªäººï¼ˆè¯šä¿¡ä½†è°ˆåˆ¤åŠ›å·®ï¼‰", effects: { supply: -5, brand: -2, risk: -5 } },
          B: { text: "æ¨¡ç³Šå›ç­”ï¼šæˆ‘ä»¬åœ¨ç¾å›½æœ‰é”€å”®ç½‘ç»œ", effects: { supply: 5, risk: 5, brand: 2 } },
          C: { text: "å¹ç‰›ï¼šæˆ‘ä»¬æ˜¯ç¾å›½å¤§å‹åˆ†é”€å•†", effects: { supply: 10, risk: 15, brand: 5 } },
          D: { text: "åé—®å¯¹æ–¹å¸‚åœºè§„åˆ’ï¼Œä¾§é¢å±•ç°ä¸“ä¸šåº¦", effects: { supply: 5, growth: 5, brand: 3 } }
        }
      },
      {
        id: 4,
        text: "ç¬¬ä¸€æ‰¹é‹åˆ°ç¾å›½äº†ï¼Œä½ æ‰“ç®—æ€ä¹ˆå–ï¼Ÿ",
        options: {
          A: { text: "è‡ªå·±å¼€è½¦è·‘æ ¡å›­ï¼Œä¸€åŒä¸€åŒåœ°å–", effects: { brand: 15, cash: 5, growth: 10, team: 5, risk: -5 } },
          B: { text: "æ‰¾é›¶å”®åº—é“ºé“ºè´§ï¼ˆæ‰¹å‘ä¸ºä¸»ï¼‰", effects: { cash: 10, supply: 5, brand: 5 } },
          C: { text: "è®©æœ‹å‹å¸®å¿™å–ï¼ˆè½»æ¾ä½†ä¸å¯æ§ï¼‰", effects: { cash: 5, team: 5, risk: 5 } },
          D: { text: "ç ¸å¹¿å‘Šæ¨å¹¿ï¼ˆå¿«é€Ÿæ‰“å“åæ°”ï¼‰", effects: { cash: -15, brand: 15, risk: 5 } }
        }
      },
      {
        id: 5,
        text: "é”€é‡å¼€å§‹èµ·æ¥ï¼Œä½†ç°é‡‘å‘¨è½¬ä¸è¿‡æ¥ï¼Œä½ æ€ä¹ˆåŠï¼Ÿ",
        options: {
          A: { text: "å‘é“¶è¡Œç”³è¯·è´·æ¬¾ï¼ˆæ­£è·¯ï¼Œä½†èƒŒè´Ÿå€ºåŠ¡ï¼‰", effects: { cash: 30, risk: 10, supply: 10, brand: 5, growth: 5 } },
          B: { text: "å‘çˆ¶æ¯å€Ÿé’±ï¼ˆå¿«é€Ÿä½†å‹åŠ›åœ¨å®¶åº­ï¼‰", effects: { cash: 15, team: -5, risk: 5 } },
          C: { text: "åˆ·ä¿¡ç”¨å¡é€æ”¯ï¼ˆéå¸¸å±é™©ï¼‰", effects: { cash: 20, risk: 20 } },
          D: { text: "åœä¸‹æ‰©å¼ ï¼Œæ…¢æ…¢å–ï¼ˆä¿å®ˆï¼‰", effects: { growth: -10, risk: -10, supply: -5 } }
        }
      },
      {
        id: 6,
        text: "ä½ é‡åˆ°äº†ç–¯å­å‹é”€å”® Johnsonï¼Œä½ å¦‚ä½•ç®¡ç†ä»–ï¼Ÿ",
        options: {
          A: { text: "æ”¾æ‰‹è®©ä»–è‡ªç”±å‘æŒ¥ï¼ˆé«˜å¢é•¿é«˜æ··ä¹±ï¼‰", effects: { brand: 15, team: 10, cash: 10, growth: 10, risk: 5, supply: -5 } },
          B: { text: "è®¾å®šä¸¥æ ¼ KPI è¿›è¡Œç®¡æ§", effects: { brand: 0, team: -5, cash: 5, growth: 5, risk: -5 } },
          C: { text: "è®©ä»–è´Ÿè´£é‡ç‚¹å®¢æˆ·ï¼Œæœ‰é™åº¦åœ°æ”¾æƒ", effects: { brand: 10, team: 5, cash: 5, growth: 5 } },
          D: { text: "è§‰å¾—å¤ªéš¾ç®¡ï¼Œå¹²è„†å¼€é™¤ä»–", effects: { brand: -10, team: -5, growth: -5 } }
        }
      },
      {
        id: 7,
        text: "ä¾›åº”é“¾ç¬¬ä¸€æ¬¡å‡ºç°æ–­è´§é£é™©ï¼Œä½ æ€ä¹ˆåŠï¼Ÿ",
        options: {
          A: { text: "å‘ç°æœ‰ä¾›åº”å•†æ–½å‹ï¼Œé€¼ä»–ä¼˜å…ˆç»™ä½ äº§èƒ½", effects: { supply: -5, risk: 5, brand: -2 } },
          B: { text: "è‡ªå·±å†æ‰¾ä¸€å®¶ä¾›åº”å•†ï¼Œåšå¤šå…ƒåŒ–å¸ƒå±€", effects: { supply: 20, risk: -20, cash: -10, brand: 10, team: 5, growth: 10 } },
          C: { text: "é€‰æ‹©ç­‰å¾…ï¼Œçœ‹æƒ…å†µå†è¯´", effects: { supply: -15, cash: -5, risk: 5 } },
          D: { text: "åœ¨å…¬å¼€åœºåˆåæ§½ä¾›åº”å•†ï¼Œè®©èˆ†è®ºæ–½å‹", effects: { brand: -20, risk: 20 } }
        }
      },
      {
        id: 8,
        text: "ç«äº‰å¯¹æ‰‹å¼€å§‹æŠ„è¢­ä½ çš„è®¾è®¡ï¼Œä½ æ€ä¹ˆåŠï¼Ÿ",
        options: {
          A: { text: "ç»§ç»­çŒ›åšæ–°å“è¿­ä»£ï¼Œä¿æŒæŠ€æœ¯é¢†å…ˆ", effects: { brand: 10, cash: -5, growth: 10 } },
          B: { text: "æ‰“å®˜å¸ç»´æƒï¼ˆçƒ§é’±ä½†æ ‘ç«‹ç«‹åœºï¼‰", effects: { cash: -20, brand: 10, risk: -5, team: 5, growth: 5 } },
          C: { text: "é é™ä»·è·Ÿå¯¹æ‰‹æ‹¼ä»·æ ¼", effects: { cash: -10, brand: -10, risk: 10 } },
          D: { text: "ä»äº§å“è½¬å‘å¼ºè°ƒå“ç‰Œæ•…äº‹å’Œè¿åŠ¨å‘˜å½¢è±¡", effects: { brand: 15, cash: -5, growth: 5 } }
        }
      },
      {
        id: 9,
        text: "ä½ çš„è·‘é‹å“ç‰Œé€æ¸æˆåï¼Œè¦ä¸è¦æ‰©å±•å“ç±»ï¼Ÿ",
        options: {
          A: { text: "æš‚æ—¶ä¸æ‰©ï¼Œç»§ç»­æ·±è€•è·‘é‹", effects: { risk: -15, cash: 10, team: 5, supply: 5, growth: -5 } },
          B: { text: "æ‰©å±•ç¯®çƒé‹ï¼ŒæŠ¼æ³¨æ–°èµ›é“", effects: { growth: 15, cash: -10, risk: 10, brand: 10 } },
          C: { text: "åšè¿åŠ¨æœè£…ï¼Œå°è¯•æå‡å®¢å•ä»·", effects: { brand: 10, cash: -5, risk: 5 } },
          D: { text: "é‹ã€æœã€é…ä»¶ä¸€èµ·æ‰©ï¼ˆå…¨çº¿å¼€ç«ï¼‰", effects: { growth: 20, cash: -20, risk: 20 } }
        }
      },
      {
        id: 10,
        text: "æ¬§æ´²æ¸ é“å•†æ‰¾ä¸Šé—¨ï¼Œä½ ç¬¬ä¸€æ¬¡è¿æ¥å…¨çƒåŒ–æœºä¼šï¼Œæ€ä¹ˆåšï¼Ÿ",
        options: {
          A: { text: "å°è§„æ¨¡è‡ªè¥è¯•æ°´ï¼Œæ…¢æ…¢æ‘¸ç´¢", effects: { growth: 10, cash: -10, risk: 5, brand: 5 } },
          B: { text: "å¤§è§„æ¨¡è¿›å…¥ï¼Œé‡ä»“æ¬§æ´²å¸‚åœº", effects: { growth: 20, cash: -20, risk: 20, brand: 15 } },
          C: { text: "æ‰¾å½“åœ°ä»£ç†åšï¼Œè½»èµ„äº§å…¨çƒåŒ–", effects: { supply: 10, risk: -10, brand: 15, growth: 10, team: 5 } },
          D: { text: "æš‚ç¼“ï¼Œè§‰å¾—æ—¶æœºæœªåˆ°", effects: { growth: -5, risk: -5 } }
        }
      },
      {
        id: 11,
        text: "æŠ•èµ„äººé—®ï¼šè¦ä¸è¦ç°åœ¨å°±ä¸Šå¸‚ï¼Ÿ",
        options: {
          A: { text: "ç«‹åˆ»ä¸Šå¸‚ï¼Œæ‹¿é’±ã€æ‰©å¼ ï¼", effects: { cash: 50, risk: 20, brand: 10, growth: 15 } },
          B: { text: "å†ç­‰ä¸€å¹´ï¼ŒæŠŠåŸºç¡€æ‰“ç¨³å†ä¸Šå¸‚", effects: { risk: -10, brand: 10, team: 10, growth: 5, supply: 5 } },
          C: { text: "å…ˆå†èä¸€è½®ç§å‹Ÿï¼Œæš‚ä¸ä¸Šå¸‚", effects: { cash: 20, risk: 5, growth: 5 } },
          D: { text: "æ‹’ç»ä¸Šå¸‚ï¼Œä¿æŒç»å¯¹æ§åˆ¶æƒ", effects: { risk: -5, brand: 0, growth: -5 } }
        }
      }
    ];

    // å®è§‚äº‹ä»¶é…ç½®ï¼ˆæ¦‚ç‡è§¦å‘ï¼‰
    const macroEvents = [
      {
        id: "oil-war",
        name: "ä¸­ä¸œå±€åŠ¿å‡çº§ï¼Œæ²¹ä»·æš´æ¶¨",
        desc: "æˆ˜äº‰æ¨é«˜æ²¹ä»·ï¼Œæµ·è¿æˆæœ¬é£™å‡ï¼Œä½ çš„ä¾›åº”é“¾æ‰¿å‹ã€‚",
        weight: 3,
        condition: (round, state, macro) => true,
        effects: {
          stats: { cash: -5, supply: -5, risk: 5 },
          macro: { inflation: 0.5, externalSupplyRisk: 8, geoTension: 5 }
        }
      },
      {
        id: "fed-hike",
        name: "ç¾è”å‚¨æ¿€è¿›åŠ æ¯",
        desc: "å…¨çƒåˆ©ç‡ä¸Šå‡ï¼Œèèµ„å˜è´µï¼Œæ¶ˆè´¹è€…ä¹Ÿæ›´ä¿å®ˆã€‚",
        weight: 3,
        condition: (round, state, macro) => round >= 3,
        effects: {
          stats: { cash: -5, growth: -5, risk: 3 },
          macro: { interestRate: 0.75, consumerConfidence: -5 }
        }
      },
      {
        id: "fed-cut",
        name: "ç¾è”å‚¨æ„å¤–é™æ¯",
        desc: "åˆ©ç‡ä¸‹è°ƒï¼Œå…¨çƒèµ„é‡‘æ›´ä¾¿å®œï¼Œæ¶ˆè´¹ç•¥æœ‰æ¢å¤ã€‚",
        weight: 2,
        condition: (round, state, macro) => macro.interestRate > 3.5,
        effects: {
          stats: { cash: 5, growth: 5 },
          macro: { interestRate: -0.5, consumerConfidence: 5 }
        }
      },
      {
        id: "us-china-tariff-up",
        name: "ä¸­ç¾è´¸æ˜“æ‘©æ“¦å‡çº§",
        desc: "ç¾å›½æé«˜å¯¹ä½ æ‰€åœ¨å›½å®¶çš„é‹ç±»å…³ç¨ï¼Œä½ åœ¨æµ·å¤–çš„åˆ©æ¶¦è¢«å‹ç¼©ã€‚",
        weight: 3,
        condition: (round, state, macro) => round >= 5 && state.brand >= 30,
        effects: {
          stats: { growth: -5, brand: -5, risk: 5 },
          macro: { tariff: 5, geoTension: 10, consumerConfidence: -3 }
        }
      },
      {
        id: "us-china-relief",
        name: "ä¸­ç¾é˜¶æ®µæ€§è¾¾æˆè´¸æ˜“ç¼“å’Œåè®®",
        desc: "å…³ç¨æœ‰æ‰€å›è½ï¼Œç´§å¼ èˆ†è®ºæš‚æ—¶ç¼“å’Œã€‚",
        weight: 2,
        condition: (round, state, macro) => macro.tariff >= 15,
        effects: {
          stats: { growth: 5, brand: 5 },
          macro: { tariff: -5, geoTension: -8, consumerConfidence: 4 }
        }
      },
      {
        id: "port-strike",
        name: "é‡è¦æ¸¯å£å·¥äººç½¢å·¥",
        desc: "ä½ çš„ä¸€æ‰¹è´§è¢«è¿«æ»ç•™æ¸¯å£ï¼Œå‘è´§å»¶è¯¯ï¼Œå®¢æˆ·æŠ•è¯‰ã€‚",
        weight: 3,
        condition: (round, state, macro) => round >= 4,
        effects: {
          stats: { cash: -8, supply: -10, risk: 5, brand: -3 },
          macro: { externalSupplyRisk: 10 }
        }
      },
      {
        id: "sports-boom",
        name: "å…¨çƒä½“è‚²çƒ­æ½®ï¼ˆå¥¥è¿ä¼š / ä¸–ç•Œæ¯ï¼‰",
        desc: "å…¨çƒè·‘æ­¥ã€å¥èº«çƒ­æƒ…é«˜æ¶¨ï¼Œè¿åŠ¨é‹éœ€æ±‚æ¿€å¢ã€‚",
        weight: 4,
        condition: (round, state, macro) => state.brand >= 10,
        effects: {
          stats: { cash: 10, growth: 12, brand: 8 },
          macro: { consumerConfidence: 10 }
        }
      },
      {
        id: "black-swan-canal",
        name: "é»‘å¤©é¹…ï¼šè¿æ²³å µå¡ï¼Œå…¨çƒèˆªè¿å¤§ä¹±",
        desc: "ä¸€è‰˜å·¨è½®å¡åœ¨å…³é”®è¿æ²³ï¼Œä½ çš„ä¸€æ‰¹è´§ä¹Ÿè¢«å µåœ¨æµ·ä¸Šã€‚",
        weight: 1, // ç¨€æœ‰
        condition: (round, state, macro) => round >= 6,
        effects: {
          stats: { cash: -12, supply: -15, risk: 10 },
          macro: { externalSupplyRisk: 15, inflation: 0.8, geoTension: 5 }
        }
      }
    ];

    let currentIndex = 0;

    function updateStatsView() {
      document.getElementById("stat-cash").textContent = state.cash;
      document.getElementById("stat-supply").textContent = state.supply;
      document.getElementById("stat-brand").textContent = state.brand;
      document.getElementById("stat-team").textContent = state.team;
      document.getElementById("stat-growth").textContent = state.growth;
      document.getElementById("stat-risk").textContent = state.risk;

      // å®è§‚
      document.getElementById("macro-usd").textContent = macro.usdRate.toFixed(2);
      document.getElementById("macro-tariff").textContent = macro.tariff.toFixed(0) + "%";
      document.getElementById("macro-inflation").textContent = macro.inflation.toFixed(1) + "%";
      document.getElementById("macro-interest").textContent = macro.interestRate.toFixed(2) + "%";
      document.getElementById("macro-supplyrisk").textContent = macro.externalSupplyRisk.toFixed(0);
      document.getElementById("macro-confidence").textContent = macro.consumerConfidence.toFixed(0);
      document.getElementById("macro-geo").textContent = macro.geoTension.toFixed(0);

      // ç®€å•é¢„è­¦æç¤º
      setWarn("macro-usd-warn", macro.usdRate > 7.8, "ç¾å…ƒåå¼ºï¼šè¿›å£æˆæœ¬åœ¨ä¸Šå‡ã€‚");
      setWarn("macro-tariff-warn", macro.tariff >= 20, "å…³ç¨åé«˜ï¼šæµ·å¤–åˆ©æ¶¦è¢«ä¸¥é‡å‹ç¼©ã€‚");
      setWarn("macro-inflation-warn", macro.inflation >= 5, "é€šèƒ€èµ°é«˜ï¼šåŸææ–™ã€äººå·¥æˆæœ¬å…¨é¢ä¸Šå‡ã€‚");
      setWarn("macro-interest-warn", macro.interestRate >= 5, "åˆ©ç‡åé«˜ï¼šè´·æ¬¾å’Œèèµ„æˆæœ¬å¾ˆè´µã€‚");
      setWarn("macro-supplyrisk-warn", macro.externalSupplyRisk >= 40, "å¤–éƒ¨ä¾›åº”é“¾é£é™©åé«˜ï¼Œå°å¿ƒæ–­è´§ã€‚");
      setWarn("macro-confidence-warn", macro.consumerConfidence <= 60, "æ¶ˆè´¹è€…ä¿¡å¿ƒä¸è¶³ï¼Œéœ€æ±‚èµ°å¼±ã€‚");
      setWarn("macro-geo-warn", macro.geoTension >= 40, "åœ°ç¼˜ç´§å¼ å‡çº§ï¼Œå¯èƒ½è§¦å‘é¢å¤–åˆ¶è£æˆ–å†²çªã€‚");
    }

    function setWarn(id, condition, text) {
      const el = document.getElementById(id);
      el.textContent = condition ? text : "";
    }

    function isBankrupt() {
      if (state.cash < -10) {
        return "ç°é‡‘æµå½»åº•å´©æºƒï¼ˆcash < -10ï¼‰";
      }
      if (state.supply < -20) {
        return "ä¾›åº”é“¾å®Œå…¨æ–­è£‚ï¼ˆsupply < -20ï¼‰";
      }
      if (state.team < -15) {
        return "æ ¸å¿ƒå›¢é˜Ÿæµå¤±æ®†å°½ï¼ˆteam < -15ï¼‰";
      }
      return null;
    }

    function evaluateEnding() {
      const deathReason = isBankrupt();
      // å°†å¤–éƒ¨å®è§‚é£é™©ä¹Ÿå åŠ è¿›ç»¼åˆé£é™©ä¸­
      const macroRiskScore = macro.externalSupplyRisk * 0.3 + macro.geoTension * 0.3 + macro.inflation * 0.5;
      const effectiveRisk = state.risk + macroRiskScore * 0.2;

      if (deathReason) {
        return {
          title: "ã€ç»“å±€ï¼šè¢«å‘¨æœŸç¢¾ç¢ã€‘",
          text: `åŸå› ï¼š${deathReason}\n\nä½ ä¸ä»…æ²¡æ‰›ä½å…¬å¸å†…éƒ¨çš„ç»è¥å‹åŠ›ï¼Œä¹Ÿè¢«å®è§‚å‘¨æœŸä¸€èµ·æ”¶å‰²äº†ã€‚`
        };
      }

      const power =
        state.brand * 1.5 +
        state.growth * 1.2 +
        state.supply * 1.0 +
        state.team * 1.0 +
        state.cash * 0.8 -
        effectiveRisk * 0.5;

      if (power >= 230 && state.brand >= 80 && state.growth >= 60) {
        return {
          title: "ã€ç»“å±€ï¼šç©¿è¶Šå‘¨æœŸÂ·è¶…è¶Šè€å…‹ã€‘",
          text: "ä½ ä¸ä»…å¤åˆ¶äº†å¥ˆç‰¹çš„è·¯å¾„ï¼Œè¿˜åœ¨æˆ˜äº‰ã€æ±‡ç‡å’Œä¸­ç¾å†²çªä¸­ä¿æŒæ‰©å¼ èŠ‚å¥ï¼Œæˆä¸ºçœŸæ­£æ„ä¹‰ä¸Šçš„å…¨çƒè¿åŠ¨ç¬¬ä¸€å“ç‰Œã€‚"
        };
      } else if (power >= 190 && state.brand >= 70) {
        return {
          title: "ã€ç»“å±€ï¼šå…¨çƒè¿åŠ¨å·¨å¤´ã€‘",
          text: "ä½ æˆåŠŸç©¿è¶Šå‡ è½®å®è§‚æ³¢åŠ¨ï¼Œåœ¨é«˜åˆ©ç‡ã€å…³ç¨å’Œåœ°ç¼˜å†²çªä¸­ç¨³ä½äº†åŸºæœ¬ç›˜ï¼Œæˆä¸ºä¸–ç•Œçº§è¿åŠ¨å“ç‰Œã€‚"
        };
      } else if (power >= 135 && state.brand >= 50) {
        return {
          title: "ã€ç»“å±€ï¼šä¸­å›½é¡¶çº§è¿åŠ¨å“ç‰Œã€‘",
          text: "ä½ ç±»ä¼¼å®‰è¸ / æå®ï¼Œå……åˆ†åˆ©ç”¨å®è§‚çª—å£æœŸï¼Œåœ¨å‘¨æœŸé‡Œåšæˆäº†åŒºåŸŸçº§ä¹ƒè‡³å›½å®¶çº§é¾™å¤´ã€‚"
        };
      } else if (power >= 90) {
        return {
          title: "ã€ç»“å±€ï¼šåŒºåŸŸçŸ¥åå“ç‰Œã€‘",
          text: "ä½ åœ¨æœ¬å›½ / éƒ¨åˆ†åŒºåŸŸéå¸¸æœ‰åï¼Œä½†æ²¡èƒ½è·¨è¶Šæ±‡ç‡ã€å…³ç¨å’Œåœ°ç¼˜æ”¿æ²»çš„å¢™ï¼Œå°šæœªçœŸæ­£å…¨çƒåŒ–ã€‚"
        };
      } else if (power >= 50) {
        return {
          title: "ã€ç»“å±€ï¼šæ´»ä¸‹æ¥çš„å°å…¬å¸ã€‘",
          text: "ä½ å¾ˆæ¸…é†’ã€å¾ˆåŠªåŠ›ï¼Œä¹Ÿé¿å¼€äº†å¾ˆå¤šå‘ï¼Œä½†åœ¨å®è§‚å¤§æµªé¢å‰è¿˜æ˜¯åä¿å®ˆã€‚ä½ æœ‰å°Šä¸¥åœ°æ´»ç€ï¼Œæ²¡æœ‰åšå¤§ã€‚"
        };
      } else {
        return {
          title: "ã€ç»“å±€ï¼šå‹‰å¼ºå­˜æ´»åœ¨å‘¨æœŸå¤¹ç¼ä¸­ã€‘",
          text: "ä½ å¹¶æ²¡æœ‰æ­»æ‰ï¼Œä½†ä¹Ÿå§‹ç»ˆè¢«åˆ©ç‡ã€å…³ç¨ã€é€šèƒ€å’Œå¤–éƒ¨å†²å‡»æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦ï¼Œèµ°å¾—å¾ˆè‰°éš¾ã€‚"
        };
      }
    }

    function appendLogChoice(questionId, choiceKey, effects) {
      const log = document.getElementById("log");
      const line = document.createElement("div");
      line.className = "log-line-choice";
      line.textContent =
        `ç¬¬ ${questionId} å…³ é€‰æ‹© ${choiceKey}ï¼š` +
        `cash ${effects.cash || 0}, supply ${effects.supply || 0}, ` +
        `brand ${effects.brand || 0}, team ${effects.team || 0}, ` +
        `growth ${effects.growth || 0}, risk ${effects.risk || 0}`;
      log.appendChild(line);
      log.scrollTop = log.scrollHeight;
    }

    function appendLogEvent(event, statsDelta, macroDelta) {
      const log = document.getElementById("log");
      const line = document.createElement("div");
      line.className = "log-line-event";
      const statsText =
        `cash ${statsDelta.cash || 0}, supply ${statsDelta.supply || 0}, ` +
        `brand ${statsDelta.brand || 0}, team ${statsDelta.team || 0}, ` +
        `growth ${statsDelta.growth || 0}, risk ${statsDelta.risk || 0}`;
      const macroText =
        `USD ${macroDelta.usdRate || 0}, tariff ${macroDelta.tariff || 0}, ` +
        `inflation ${macroDelta.inflation || 0}, interest ${macroDelta.interestRate || 0}, ` +
        `extSupplyRisk ${macroDelta.externalSupplyRisk || 0}, conf ${macroDelta.consumerConfidence || 0}, ` +
        `geo ${macroDelta.geoTension || 0}`;
      line.textContent = `ã€å®è§‚äº‹ä»¶ã€‘${event.name}ï¼š${event.desc} ï½œ ç»è¥å˜åŒ–ï¼š${statsText}`;
      log.appendChild(line);
      log.scrollTop = log.scrollHeight;
    }

    function applyMacroEvent(event) {
      const statsDelta = { cash: 0, supply: 0, brand: 0, team: 0, growth: 0, risk: 0 };
      const macroDelta = {
        usdRate: 0, tariff: 0, inflation: 0, interestRate: 0,
        externalSupplyRisk: 0, consumerConfidence: 0, geoTension: 0
      };
      if (event.effects.stats) {
        for (const k in event.effects.stats) {
          const v = event.effects.stats[k] || 0;
          state[k] += v;
          statsDelta[k] = v;
        }
      }
      if (event.effects.macro) {
        const e = event.effects.macro;
        if (e.usdRate) { macro.usdRate += e.usdRate; macroDelta.usdRate = e.usdRate; }
        if (e.tariff) { macro.tariff += e.tariff; macroDelta.tariff = e.tariff; }
        if (e.inflation) { macro.inflation += e.inflation; macroDelta.inflation = e.inflation; }
        if (e.interestRate) { macro.interestRate += e.interestRate; macroDelta.interestRate = e.interestRate; }
        if (e.externalSupplyRisk) { macro.externalSupplyRisk += e.externalSupplyRisk; macroDelta.externalSupplyRisk = e.externalSupplyRisk; }
        if (e.consumerConfidence) { macro.consumerConfidence += e.consumerConfidence; macroDelta.consumerConfidence = e.consumerConfidence; }
        if (e.geoTension) { macro.geoTension += e.geoTension; macroDelta.geoTension = e.geoTension; }
      }
      appendLogEvent(event, statsDelta, macroDelta);
    }

    function maybeTriggerMacroEvent() {
      // çº¦ 45% æ¦‚ç‡è§¦å‘ä¸€ä¸ªå®è§‚äº‹ä»¶ï¼›åœ¨åœ°ç¼˜ç´§å¼ é«˜æ—¶ï¼Œæ¦‚ç‡ç¨å¾®æé«˜
      let baseProb = 0.45;
      if (macro.geoTension >= 40 || macro.externalSupplyRisk >= 40) {
        baseProb += 0.15;
      }
      const roll = Math.random();
      if (roll > baseProb) return;

      // æŒ‰æ¡ä»¶ç­›é€‰å¯ç”¨äº‹ä»¶
      const available = macroEvents.filter(ev =>
        ev.condition(currentIndex + 1, state, macro)
      );
      if (available.length === 0) return;

      // ç®€å•æŒ‰ weight åšåŠ æƒéšæœº
      const totalWeight = available.reduce((sum, ev) => sum + (ev.weight || 1), 0);
      let threshold = Math.random() * totalWeight;
      let chosen = available[0];
      for (const ev of available) {
        threshold -= (ev.weight || 1);
        if (threshold <= 0) {
          chosen = ev;
          break;
        }
      }
      applyMacroEvent(chosen);
      updateStatsView();
    }

    function renderQuestion() {
      const roundInfo = document.getElementById("round-info");
      const total = questions.length;
      const q = questions[currentIndex];

      roundInfo.textContent = `ç¬¬ ${q.id} å…³ / å…± ${total} å…³`;
      document.getElementById("question-id").textContent = `Q${q.id}`;
      document.getElementById("question-text").textContent = q.text;

      const optionList = document.getElementById("option-list");
      optionList.innerHTML = "";

      for (const key of ["A", "B", "C", "D"]) {
        const opt = q.options[key];
        if (!opt) continue;
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.innerHTML = `<span class="key">${key}</span><span>${opt.text}</span>`;
        btn.onclick = () => handleChoice(key);
        optionList.appendChild(btn);
      }

      updateStatsView();
    }

    function handleChoice(key) {
      const q = questions[currentIndex];
      const opt = q.options[key];
      const effects = opt.effects || {};

      state.cash += effects.cash || 0;
      state.supply += effects.supply || 0;
      state.brand += effects.brand || 0;
      state.team += effects.team || 0;
      state.growth += effects.growth || 0;
      state.risk += effects.risk || 0;

      state.history.push({
        question: q.id,
        option: key,
        effects
      });

      appendLogChoice(q.id, key, effects);
      updateStatsView();

      // æ£€æŸ¥æ˜¯å¦æå‰æ­»äº¡
      const deathReason = isBankrupt();
      if (deathReason) {
        endGame();
        return;
      }

      // åœ¨è¿›å…¥ä¸‹ä¸€å…³å‰ï¼ŒåŸºäºå½“å‰è½®æ¬¡å’Œå®è§‚ç¯å¢ƒï¼Œæ¦‚ç‡è§¦å‘å®è§‚äº‹ä»¶
      maybeTriggerMacroEvent();

      // å†æ¬¡æ£€æŸ¥æ˜¯å¦æ­»äº¡
      if (isBankrupt()) {
        endGame();
        return;
      }

      currentIndex++;
      if (currentIndex >= questions.length) {
        endGame();
      } else {
        renderQuestion();
      }
    }

    function endGame() {
      const optionList = document.getElementById("option-list");
      optionList.innerHTML = "";

      const resultBlock = document.getElementById("result-block");
      const r = evaluateEnding();
      document.getElementById("result-title").textContent = r.title;
      document.getElementById("result-text").textContent =
        r.text + `\n\næœ€ç»ˆå…¬å¸çŠ¶æ€ï¼š\n` +
        `ğŸ’° cash=${state.cash}\nğŸ“¦ supply=${state.supply}\n` +
        `ğŸ§² brand=${state.brand}\nğŸ§‘â€ğŸ¤â€ğŸ§‘ team=${state.team}\n` +
        `ğŸ“ˆ growth=${state.growth}\nğŸŒª internal risk=${state.risk}\n\n` +
        `å®è§‚ç¯å¢ƒæ”¶å®˜ï¼š\n` +
        `ğŸ’µ USD/CNY=${macro.usdRate.toFixed(2)}  ğŸ§¾ å…³ç¨=${macro.tariff.toFixed(0)}%\n` +
        `ğŸ”¥ é€šèƒ€=${macro.inflation.toFixed(1)}%  ğŸ¦ åˆ©ç‡=${macro.interestRate.toFixed(2)}%\n` +
        `ğŸš¢ å¤–éƒ¨ä¾›åº”é“¾é£é™©=${macro.externalSupplyRisk.toFixed(0)}\n` +
        `ğŸ§  æ¶ˆè´¹è€…ä¿¡å¿ƒ=${macro.consumerConfidence.toFixed(0)}  âš”ï¸ åœ°ç¼˜ç´§å¼ åº¦=${macro.geoTension.toFixed(0)}\n`;

      resultBlock.style.display = "block";

      document.getElementById("question-id").textContent = "æ¸¸æˆç»“æŸ";
      document.getElementById("question-text").textContent =
        "ä½ å·²å®Œæˆå…¨éƒ¨å…³é”®æŠ‰æ‹©ï¼Œå®è§‚ä¸å¾®è§‚çš„åˆåŠ›ï¼Œå†³å®šäº†ä½ çš„å‘½è¿ã€‚";
    }

    // åˆå§‹åŒ–
    renderQuestion();
  </script>
</body>
</html>
